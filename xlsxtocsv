import pandas as pd
import os
import csv

# Loop through all Excel files in the current directory
for filename in os.listdir('.'):
    if filename.endswith('.xlsx') and not filename.startswith('~'):
        base_name = os.path.splitext(filename)[0]
        csv_file = base_name + '.csv'

        # Read the first sheet of the Excel file
        df = pd.read_excel(filename, sheet_name=0)

        # Remove newlines from all string fields
        df = df.applymap(
            lambda x: str(x).replace('\n', ' ').replace('\r', ' ') if isinstance(x, str) else x
        )

        # Replace \n and \r with a space in a specific column, e.g., 'comments'
df['comments'] = df['comments'].astype(str).str.replace('\n', ' ', regex=False).str.replace('\r', ' ', regex=False)

        # Write to CSV with all fields quoted
        df.to_csv(
            csv_file,
            index=False,
            quoting=csv.QUOTE_ALL,
            quotechar='"',
            sep=','
        )

        print(f"Converted: {filename} â†’ {csv_file} (newlines removed)")

