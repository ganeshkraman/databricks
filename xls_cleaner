mport pandas as pd
import tkinter as tk
from tkinter import filedialog
import os
import csv

def clean_excel_file(input_path):
    # Extract file name for output
    base_name = os.path.basename(input_path)
    name_without_ext = os.path.splitext(base_name)[0]
    output_file = f"{name_without_ext}_cleaned.csv"

    # Read Excel file
    df = pd.read_excel(input_path, sheet_name=0)

    # Clean column headers (remove newlines and trim spaces)
    df.columns = [col.replace('\n', ' ').replace('\r', ' ').strip() for col in df.columns]

    # Clean newlines in all string cells
    df_cleaned = df.applymap(
        lambda x: str(x).replace('\n', ' ').replace('\r', ' ').strip() if isinstance(x, str) else x
    )

    # Check for any remaining newlines
    columns_with_newlines = []
    for column in df_cleaned.columns:
        if df_cleaned[column].astype(str).str.contains(r'[\n\r]', regex=True).any():
            columns_with_newlines.append(column)

    # Report results
    if columns_with_newlines:
        print(f"‚ö†Ô∏è Newlines still found in columns: {columns_with_newlines}")
    else:
        print("‚úÖ No newlines found in any column after cleaning.")

    # Save cleaned data to CSV
    df_cleaned.to_csv(
        output_file,
        index=False,
        quoting=csv.QUOTE_ALL,
        quotechar='"',
        sep=','
    )

    print(f"\nüéØ Cleaned CSV saved as: {output_file}")

if _name_ == "_main_":
    # Launch file dialog to choose Excel file
    root = tk.Tk()
    root.withdraw()  # Hide the root window
    file_path = filedialog.askopenfilename(
        title="Select Excel File",
        filetypes=[("Excel files", "*.xlsx *.xls")]
    )

    if file_path:
        clean_excel_file(file_path)
    else:
        print("No file selected.")
